plugins {
	id 'com.android.library'
	id 'org.jetbrains.kotlin.android'
}

def NDK_PATH = ""
def hasNdkDirectory = project.hasProperty("ndkDirectory")
if(!hasNdkDirectory){
	println "No ndkDirectory set, checking environment \$ANDROID_NDK..."

	NDK_PATH = "$System.env.ANDROID_NDK"
	if (NDK_PATH == null || NDK_PATH == "null"){
		println "No ndkDirectory set, checking environment \$ANDROID_NDK_ROOT..."
		NDK_PATH = "$System.env.ANDROID_NDK_ROOT"
	}

	if (NDK_PATH == null || NDK_PATH == "null"){
		println "No ndkDirectory set, checking environment \$ANDROID_NDK_HOME..."
		NDK_PATH = "$System.env.ANDROID_NDK_HOME"
	}
} else {
	NDK_PATH = ndkDirectory
}
println "Runtime using NDK_PATH: " + NDK_PATH

android {
  namespace 'org.nativescript.sqlite.sqlitemetal'
  compileSdk 33
  defaultConfig {
    minSdk 17
    targetSdk 33

    testInstrumentationRunner "androidx.test.runner.AndroidJUnitRunner"
    consumerProguardFiles "consumer-rules.pro"

    externalNativeBuild {
      cmake {
        arguments "-DANDROID_TOOLCHAIN=clang",
          "-DANDROID_STL=c++_shared",
          "-DANDROID_NDK_ROOT=${System.getenv("ANDROID_NDK_ROOT")}"
      }
    }
    ndk {
      abiFilters 'x86','x86_64', 'armeabi-v7a', 'arm64-v8a'
    }
  }

  buildTypes {
    release {
      minifyEnabled false
      proguardFiles getDefaultProguardFile('proguard-android-optimize.txt'), 'proguard-rules.pro'
    }
  }
  compileOptions {
    sourceCompatibility JavaVersion.VERSION_1_8
    targetCompatibility JavaVersion.VERSION_1_8
  }
  kotlinOptions {
    jvmTarget = '1.8'
  }

  externalNativeBuild {
    cmake {
      path "CMakeLists.txt"
    }
  }

  ndkVersion '21.1.6352462'  // adjusted to match the working project
}

dependencies {
	implementation 'androidx.core:core-ktx:1.9.0'  // adjusted to match the working project
	implementation 'androidx.appcompat:appcompat:1.5.1'  // adjusted to match the working project
	implementation 'com.google.android.material:material:1.7.0'  // added from working project
	implementation 'com.google.code.gson:gson:2.10'  // added from working project
	testImplementation 'junit:junit:4.13.2'
	androidTestImplementation 'androidx.test.ext:junit:1.1.4'  // adjusted to match the working project
	androidTestImplementation 'androidx.test.espresso:espresso-core:3.5.0'  // adjusted to match the working project
}
